@ -0,0 +1,41 @@
name: Export Repo Tree
on:
  push:
    branches: [ "main" ]
  schedule:
    - cron: "0 2 * * *"  # tÃ¤glich um 02:00 UTC

jobs:
  export:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Generate repo introspection files
        run: |
          mkdir -p _introspection

          echo "Generating repo_tree.json ..."
          git ls-tree -r --long HEAD | awk '{
            if (NR>1) printf(",\n");
            printf("{\"path\":\"%s\",\"sha\":\"%s\",\"size\":%s}", $4, $3, $5)
          } END {print ""}' | awk 'BEGIN{print "["}{print}END{print "]"}'             > _introspection/repo_tree.json

          echo "Generating repo_index.md ..."
          echo "# Repo Index (HEAD)" > _introspection/repo_index.md
          echo "" >> _introspection/repo_index.md
          echo '```' >> _introspection/repo_index.md
          git ls-tree -r --name-only HEAD >> _introspection/repo_index.md
          echo '```' >> _introspection/repo_index.md

      - name: Commit & push if changed
        run: |
          if [ -n "$(git status --porcelain _introspection)" ]; then
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git add _introspection
            git commit -m "chore(introspection): update repo index"
            git push
          else
            echo "No changes in introspection files."
          fi