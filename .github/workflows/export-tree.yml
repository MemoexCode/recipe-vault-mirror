name: Export Repo Tree

on:
  push:
    branches:
      - main
  schedule:
    - cron: "0 2 * * *"  # tÃ¤glich um 02:00 UTC
  workflow_dispatch:

jobs:
  export:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Generate repo introspection files
        run: |
          mkdir -p _introspection

          echo "Generating repo_tree.json ..."
          git ls-tree -r --long HEAD | awk '{
            if (NR>1) printf(",\n");
            printf("{\"path\":\"%s\",\"sha\":\"%s\",\"size\":%s}", $4, $3, $5)
          } END {print ""}' | awk 'BEGIN{print "["}{print}END{print "]"}' \
            > _introspection/repo_tree.json

          echo "Generating repo_index.md ..."
          echo "# Repo Index (HEAD)" > _introspection/repo_index.md
          echo "" >> _introspection/repo_index.md
          echo '```' >> _introspection/rep_
