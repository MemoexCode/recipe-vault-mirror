name: Test Google Drive Connection (with Logging)

on:
  workflow_dispatch:  # manuell starten √ºber GitHub Actions UI

jobs:
  test-upload:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Testdatei erzeugen
      - name: Create test file
        run: |
          echo "‚úÖ Google Drive upload test successful!" > gdrive_test.txt
          echo "Timestamp: $(date)" >> gdrive_test.txt
          echo "Repository: $GITHUB_REPOSITORY" >> gdrive_test.txt
          echo "Commit: $GITHUB_SHA" >> gdrive_test.txt
          ls -lh gdrive_test.txt

      # 2Ô∏è‚É£ Datei zu Google Drive hochladen (Base44-Ordner)
      - name: Upload to Google Drive
        id: upload
        uses: adityak74/google-drive-upload-action@v1.4
        with:
          credentials: ${{ secrets.GDRIVE_SERVICE_KEY }}
          filename: gdrive_test.txt
          folderId: ${{ secrets.GDRIVE_BASE44_FOLDER_ID }}
          name: gdrive_test.txt

      # 3Ô∏è‚É£ API-Antwort und Metadaten loggen
      - name: Log upload result
        run: |
          echo "‚úÖ Upload complete!"
          echo "File ID: ${{ steps.upload.outputs.fileId }}"
          echo "Web View Link: ${{ steps.upload.outputs.webViewLink }}"
          echo "Direct Download: https://drive.google.com/uc?id=${{ steps.upload.outputs.fileId }}&export=download"
          echo ""
          echo "üìÑ File metadata:"
          echo "===================="
          ls -lh gdrive_test.txt
          echo ""
          echo "üïí Upload completed at $(date)"
